name: Windows RDP with Playit

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  windows-rdp:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Enable RDP
      run: |
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        net user hacker Password123! /add
        net localgroup administrators hacker /add
        echo "âœ… RDP enabled: user=hacker, password=Password123!"

    - name: Download Playit
      run: |
        iwr -uri "https://github.com/playit-cloud/playit-agent/releases/download/v0.16.2/playit-windows-x86_64-signed.exe" -outfile "playit.exe"

    - name: Get claim code
      id: get_code
      run: |
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ´ Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ğ¼ (Ğ½Ğµ Ğ¶Ğ´ĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ)
        $code = .\playit.exe claim generate --timeout 5
        echo "code=$code" >> $env:GITHUB_OUTPUT
        echo "ğŸ”‘ CLAIM CODE: $code"

    - name: Start agent
      run: |
        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ°Ğ³ĞµĞ½Ñ‚Ğ° Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ (Ğ¾Ğ½ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¶Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ)
        Start-Process -FilePath "playit.exe" -WindowStyle Hidden
        echo "ğŸš€ Agent started! Go claim it:"
        echo "ğŸŒ https://playit.gg/claim"
        echo "ğŸ“ CODE: ${{ steps.get_code.outputs.code }}"

    - name: Wait
      run: |
        echo "â³ Waiting 6 hours... Setup your tunnel at playit.gg"
        Start-Sleep -Seconds 21600
