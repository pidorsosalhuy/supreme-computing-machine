name: Windows RDP with Playit

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  windows-rdp:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Enable RDP
      run: |
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        net user hacker Password123! /add
        net localgroup administrators hacker /add
        echo "‚úÖ RDP enabled: user=hacker, password=Password123!"

    - name: Setup Playit
      run: |
        # –°–∫–∞—á–∏–≤–∞–µ–º playit
        iwr -uri "https://github.com/playit-cloud/playit-agent/releases/download/v0.16.2/playit-windows-x86_64-signed.exe" -outfile "playit.exe"
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –∏ —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≥–µ–Ω—Ç –≤ —Ñ–æ–Ω–µ
        $code = .\playit.exe claim generate
        echo "üîë CLAIM CODE: $code"
        echo ""
        echo "üöÄ NOW GO TO: https://playit.gg/claim"
        echo "üìù ENTER CODE: $code"
        echo ""
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≥–µ–Ω—Ç–∞ –≤ —Ñ–æ–Ω–µ (–Ω–µ –∂–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
        Start-Process -FilePath "playit.exe" -WindowStyle Hidden

    - name: Wait
      run: |
        echo "‚è≥ Agent started! Complete the claim process on website..."
        echo "After claiming, go to playit.gg ‚Üí Tunnels ‚Üí Add tunnel for port 3389"
        Start-Sleep -Seconds 21600
